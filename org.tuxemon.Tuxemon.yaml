---
app-id: org.tuxemon.Tuxemon
runtime: org.freedesktop.Platform
runtime-version: 21.08
sdk: org.freedesktop.Sdk
command: org.tuxemon.Tuxemon
rename-icon: icon
finish-args:
- --socket=wayland
- --socket=x11
- --share=ipc
- --filesystem=home
- --share=network
- --socket=pulseaudio
- --device=dri
modules:
  # needed by pygame
  # otherwise an error message occurs which complains about setuptools
  - name: portmidi
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/PortMidi/portmidi.git
        tag: v2.0.3

  - python3-requirements.json
  - name: tuxemon
    buildsystem: simple
    build-commands:
      - install -d /app/share
      - install -d /app/bin
      - install -d /app/share/tuxemon
      - cp -r  tuxemon /app/share/tuxemon
      - cp run_tuxemon.py /app/share/tuxemon/org.tuxemon.Tuxemon.py
      - ln -s ../share/tuxemon/org.tuxemon.Tuxemon.py /app/bin
      - install org.tuxemon.Tuxemon /app/bin
    post-install:
      - desktop-file-install --dir=/app/share/applications buildconfig/flatpak/org.tuxemon.Tuxemon.desktop
      - install -Dm755 buildconfig/flatpak/org.tuxemon.Tuxemon.appdata.xml /app/share/metainfo/org.tuxemon.Tuxemon.appdata.xml
      - install -Dm755 mods/tuxemon/gfx/icon.png /app/share/icons/hicolor/64x64/apps/icon.png
      - install -Dm755 mods/tuxemon/gfx/icon_32.png /app/share/icons/hicolor/32x32/apps/icon.png

    sources:
    - type: git
      tag: v0.4.33
      url: https://github.com/Tuxemon/Tuxemon.git
    - type: script
      dest-filename: org.tuxemon.Tuxemon
      commands:
      - MY_PATH="$(dirname "$0")"
      - python3 "$MY_PATH/org.tuxemon.Tuxemon.py"
