app-id: com.github.chipmuenk.pyFDA
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
command: pyfdax
finish-args:
- "--socket=wayland"
- "--socket=fallback-x11"
- "--device=dri"
- "--own-name=com.github.chipmuenk.pyFDA"
- "--filesystem=home"
rename-icon: pyfda_icon #Image will renamed to match the app-id konvention
rename-appdata-file: pyFDA.appdata.xml
rename-desktop-file: pyFDA.desktop
modules:

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/df/9e/d1a7217f69310c1db8fdf8ab396229f55a699ce34a203691794c5d1cad0c/packaging-21.3.tar.gz
        sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
        x-checker-data:
          type: pypi
          name: packaging
      #- type: patch
        #path: relax-dependencies.patch

  - name: python-pyparsing
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/d6/60/9bed18f43275b34198eb9720d4c1238c68b3755620d20df0afd89424d32b/pyparsing-3.0.7.tar.gz
        sha256: 18ee9022775d270c55187733956460083db60b37d0d0fb357445f3094eed3eea
        x-checker-data:
          type: pypi
          name: pyparsing 

  - name: python-numpy
    buildsystem: simple
    build-commands:
      - rm pyproject.toml
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/64/4a/b008d1f8a7b9f5206ecf70a53f84e654707e7616a771d84c05151a4713e9/numpy-1.22.3.zip
        sha256: dbc7601a3b7472d559dc7b933b18b4b66f9aa7452c120e87dfb33d02008c8a18
        x-checker-data:
          type: pypi
          name: numpy
          
  - name: python-certifi # needed by matplotlib
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/6c/ae/d26450834f0acc9e3d1f74508da6df1551ceab6c2ce0766a593362d6d57f/certifi-2021.10.8.tar.gz
        sha256: 78884e7c1d4b00ce3cea67b44566851c4343c120abd683433ce934a68ea58872
        x-checker-data:
          type: pypi
          name: certifi
          
  - name: qhull # needed by matplotlib
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e

  - name: python-setuptools-scm
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4a/18/477d3d9eb2f88230ff2a41de9d8ffa3554b706352787d289f57f76bfba0b/setuptools_scm-6.4.2.tar.gz
        sha256: 6833ac65c6ed9711a4d5d2266f8024cfa07c533a0e55f4c12f6eff280a5a9e30
        x-checker-data:
          type: pypi
          name: setuptools-scm
          
  - name: python-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install . --prefix=/app --no-index --find-links .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
        sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f
        x-checker-data:
          type: pypi
          name: flit_core
          
  - python3-tomli.json # needed by python-setuptools-scm-git-archive     
          
  - name: python-setuptools-scm-git-archive # needed by matplotlib
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/7e/2c/0c15b29a1b5940250bfdc4a4f53272e35cd7cf8a34159291b6b4ec9eb291/setuptools_scm_git_archive-1.1.tar.gz
        sha256: 6026f61089b73fa1b5ee737e95314f41cb512609b393530385ed281d0b46c062
        x-checker-data:
          type: pypi
          name: setuptools-scm-git-archive
  
  
          
  - name: python-matplotlib
    buildsystem: simple
    build-options:
      env:
        MPLSETUPCFG: /run/build/python-matplotlib/matplotlib-setup.cfg
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: file
        path: matplotlib-setup.cfg
      - type: archive
        url: https://files.pythonhosted.org/packages/8a/46/425a44ab9a71afd2f2c8a78b039c1af8ec21e370047f0ad6e43ca819788e/matplotlib-3.5.1.tar.gz
        sha256: b2e9810e09c3a47b73ce9cab5a72243a1258f61e7900969097a817232246ce1c
        x-checker-data:
          type: pypi
          name: matplotlib
          
  - name: python-setuptools_scm
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4a/18/477d3d9eb2f88230ff2a41de9d8ffa3554b706352787d289f57f76bfba0b/setuptools_scm-6.4.2.tar.gz
        sha256: 6833ac65c6ed9711a4d5d2266f8024cfa07c533a0e55f4c12f6eff280a5a9e30
        x-checker-data:
          type: pypi
          name: setuptools_scm
  

  - name: pyFDA
    buildsystem: simple
    build-commands:
    - python3 setup.py install --prefix=/app
    - desktop-file-install --dir=/app/share/applications ressource/mime/applications/pyFDA.desktop
    - install -Dm755 ressource/pyFDA.appdata.xml /app/share/appdata/pyFDA.appdata.xml
    # TODO: add other sizes to pyfda and then include them here
    # - install -Dm755 docs/source/img/pyfda_icon.png /app/share/icons/hicolor/100x100/apps/pyfda_icon.png
    - install -Dm755 docs/source/img/pyfda_icon.svg /app/share/icons/hicolor/scalable/apps/pyfda_icon.svg
    sources:
    - type: git
      url: https://github.com/chipmuenk/pyFDA.git
      tag: v0.6.1
