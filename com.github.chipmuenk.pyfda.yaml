app-id: com.github.chipmuenk.pyFDA
runtime: org.kde.Platform
runtime-version: '5.12'
sdk: org.kde.Sdk
command: pyfdax
finish-args:
- "--socket=wayland"
- "--socket=x11"
- "--device=dri"
- "--filesystem=xdg-run/dconf"
- "--filesystem=~/.config/dconf:ro"
- "--talk-name=ca.desrt.dconf"
- "--env=DCONF_USER_CONFIG_DIR=.config/dconf"
- "--own-name=com.github.chipmuenk.pyFDA"
- "--filesystem=home"
rename-icon: pyfda_icon #Image will renamed to match the app-id konvention
rename-appdata-file: pyFDA.appdata.xml
rename-desktop-file: pyFDA.desktop
modules:
- name: PyQt5
  cleanup:
  - "/bin/sip"
  - "/include"
  - "/lib/python3.7/site-packages/*.pyi"
  config-opts:
  - --disable-static
  - --enable-x11
  buildsystem: simple
  build-commands:
  - python3 configure.py --confirm-license --no-docstrings --assume-shared --no-sip-files
    --no-qml-plugin --no-tools --no-qsci-api -d ${FLATPAK_DEST}/lib/python3.7/site-packages
    --sip=${FLATPAK_DEST}/bin/sip --sip-incdir=${FLATPAK_DEST}/include --stubsdir=${FLATPAK_DEST}/lib/python3.7/site-packages
    --disable=QtSensors --disable=QtWebEngine --disable=QtQuick --disable=QtQml --disable=QtWebChannel
    --disable=QtWebEngineCore --disable=QWebEngineWidgets --disable=QtQuickWidgets
    --disable=QtSql --disable=QtXmlPatterns --disable=QtMultimedia --disable=QtMultimediaWidgets
    --disable=QtLocation --disable=QtDesigner --disable=QtBluetooth --disable=QtWebKit
    --disable=QtWebKitWidgets --disable=QtNfc --disable=QtPositioning
  - make -j $(nproc)
  - make install
  sources:
  - type: archive
    url: https://www.riverbankcomputing.com/static/Downloads/PyQt5/5.12.1/PyQt5_gpl-5.12.1.tar.gz
    sha256: 3718ce847d824090fd5f95ff3f13847ee75c2507368d4cbaeb48338f506e59bf
  modules:    
  - python3-modules.json # include dependencies

- name: pyFDA
  buildsystem: simple
  build-commands:
  - python3 setup.py install --prefix=/app
  - desktop-file-install --dir=/app/share/applications ressource/mime/applications/pyFDA.desktop
  - install -Dm755 ressource/pyFDA.appdata.xml /app/share/appdata/pyFDA.appdata.xml
  - install -Dm755 docs/source/img/pyfda_icon.png /app/share/icons/hicolor/100x100/apps/pyfda_icon.png
  - install -Dm755 docs/source/img/pyfda_icon.svg /app/share/icons/hicolor/scalable/apps/pyfda_icon.svg
  sources:
  - type: git
    branch: develop
    url: https://github.com/chipmuenk/pyFDA.git
